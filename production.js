import e from"https://cdn.skypack.dev/device-detector-js@2.2.10";function removeElements(e,n){for(let a of n)delete e[a]}function removeLandmarks(e){e.poseLandmarks&&removeElements(e.poseLandmarks,[0,1,2,3,4,5,6,7,8,9,10,17,18,19,20,21,22])}function testSupport(n){let a=new e,t=a.parse(navigator.userAgent),s=!1;for(let o of n){if(void 0!==o.client){let i=RegExp(`^${o.client}$`);if(!i.test(t.client.name))continue}if(void 0!==o.os){let l=RegExp(`^${o.os}$`);if(!l.test(t.os.name))continue}s=!0;break}s||alert(`This demo, running on ${t.client.name}/${t.os.name}, is not well supported at this time, expect some flakiness while we improve our code.`)}testSupport([{client:"Chrome"},]);let controls=window,LandmarkGrid=window.LandmarkGrid,drawingUtils=window,mpPose=window,options={locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose@${mpPose.VERSION}/${e}`},videoElement=document.getElementsByClassName("input_video")[0],canvasElement=document.getElementsByClassName("output_canvas")[0],controlsElement=document.getElementsByClassName("control-panel")[0],canvasCtx=canvasElement.getContext("2d"),fpsControl=new controls.FPS,spinner=document.querySelector(".loading");spinner.ontransitionend=()=>{spinner.style.display="none"};let landmarkContainer=document.getElementsByClassName("landmark-grid-container")[0],grid=new LandmarkGrid(landmarkContainer,{connectionColor:13421772,definedColors:[{name:"LEFT",value:16753920},{name:"RIGHT",value:65535}],range:2,fitToGrid:!0,labelSuffix:"m",landmarkSize:2,numCellsPerAxis:4,showHidden:!1,centered:!0}),activeEffect="mask";function onResults(e){document.body.classList.add("loaded"),removeLandmarks(e),fpsControl.tick(),canvasCtx.save(),canvasCtx.clearRect(0,0,canvasElement.width,canvasElement.height),e.segmentationMask?(canvasCtx.drawImage(e.segmentationMask,0,0,canvasElement.width,canvasElement.height),"mask"===activeEffect||"both"===activeEffect?(canvasCtx.globalCompositeOperation="source-in",canvasCtx.fillStyle="#00FF007F",canvasCtx.fillRect(0,0,canvasElement.width,canvasElement.height)):(canvasCtx.globalCompositeOperation="source-out",canvasCtx.fillStyle="#0000FF7F",canvasCtx.fillRect(0,0,canvasElement.width,canvasElement.height)),canvasCtx.globalCompositeOperation="destination-atop",canvasCtx.drawImage(e.image,0,0,canvasElement.width,canvasElement.height),canvasCtx.globalCompositeOperation="source-over"):canvasCtx.drawImage(e.image,0,0,canvasElement.width,canvasElement.height),e.poseLandmarks&&(drawingUtils.drawConnectors(canvasCtx,e.poseLandmarks,mpPose.POSE_CONNECTIONS,{visibilityMin:.65,color:"white"}),drawingUtils.drawLandmarks(canvasCtx,Object.values(mpPose.POSE_LANDMARKS_LEFT).map(n=>e.poseLandmarks[n]),{visibilityMin:.65,color:"white",fillColor:"rgb(255,138,0)"}),drawingUtils.drawLandmarks(canvasCtx,Object.values(mpPose.POSE_LANDMARKS_RIGHT).map(n=>e.poseLandmarks[n]),{visibilityMin:.65,color:"white",fillColor:"rgb(0,217,231)"}),drawingUtils.drawLandmarks(canvasCtx,Object.values(mpPose.POSE_LANDMARKS_NEUTRAL).map(n=>e.poseLandmarks[n]),{visibilityMin:.65,color:"white",fillColor:"white"})),canvasCtx.restore(),e.poseWorldLandmarks?grid.updateLandmarks(e.poseWorldLandmarks,mpPose.POSE_CONNECTIONS,[{list:Object.values(mpPose.POSE_LANDMARKS_LEFT),color:"LEFT"},{list:Object.values(mpPose.POSE_LANDMARKS_RIGHT),color:"RIGHT"},]):grid.updateLandmarks([])}let pose=new mpPose.Pose(options);pose.onResults(onResults),new controls.ControlPanel(controlsElement,{modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!0,smoothSegmentation:!0,minDetectionConfidence:.5,minTrackingConfidence:.5,effect:"background"}).add([fpsControl,new controls.SourcePicker({onSourceChanged(){pose.reset()},async onFrame(e,n){let a=n.height/n.width,t,s;window.innerWidth>window.innerHeight?t=(s=window.innerHeight)/a:s=(t=window.innerWidth)*a,canvasElement.width=t,canvasElement.height=s,await pose.send({image:e})}}),]).on(e=>{let n=e;videoElement.classList.toggle("selfie",n.selfieMode),pose.setOptions(n)});